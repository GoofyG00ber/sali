<template>
  <div class="cards">
    <div v-for="item in items" :key="item.id" class="card">
      <div class="card-content">
        <div class="card-left">
          <h3 class="name">{{ item.title }}</h3>
          <p class="desc">{{ item.description }}</p>

          <div v-if="item.prices && item.prices.length" class="prices">
            <button
              v-for="p in item.prices"
              :key="p.label"
              type="button"
              :class="{ selected: selectedPrices[item.id]?.label === p.label }"
              @click="selectPrice(item.id, p)"
            >
              {{ p.label }}
            </button>
          </div>
          <div v-else class="prices-empty">Ár hamarosan</div>

          <div class="bottom-row">
            <div class="price-display">
              <span v-if="selectedPrices[item.id]?.price" class="price-amount">
                {{ formatPrice(selectedPrices[item.id]!.price) }} Ft
              </span>
              <span v-else class="price-amount">-</span>
            </div>

            <div class="actions">
              <button v-if="item.category_id === 1" class="btn-outline" type="button" title="További feltétek hozzáadása" @click="openExtrasModal(item)">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19" />
                  <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
                 Feltétek
              </button>
              <button class="btn-primary" type="button" :disabled="!(item.prices && item.prices.length)" @click="addToCart(item)" title="Kosárba helyezés">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="9" cy="21" r="1" />
                  <circle cx="20" cy="21" r="1" />
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="card-right">
        <div v-if="!item.image || item.image === 'null'" class="icon-container">
          <component :is="getCategoryIcon(item.category_id)" />
        </div>
        <img v-else :src="item.image" alt="" />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { reactive, watch, h } from 'vue'
import type { PropType } from 'vue'

type Price = { label: string; price: number }
type Item = { id: number; title: string; description?: string; prices?: Price[]; image?: string; category_id?: number }

const props = defineProps({ items: { type: Array as PropType<Item[]>, required: true } })
const emit = defineEmits<{
  (e: 'add', payload: { item: Item; price: Price }): void
  (e: 'openExtras', payload: { item: Item }): void
}>()

const selectedPrices = reactive<Record<number, Price>>({})

// Category icon components
const PizzaIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 512 512', fill: '#ff6106' }, [
  h('path', { d: 'M158.87.15c-16.16-1.52-31.2 8.42-35.33 24.12l-14.81 56.27c187.62 5.49 314.54 130.61 322.48 317l56.94-15.78c15.72-4.36 25.49-19.68 23.62-35.9C490.89 165.08 340.78 17.32 158.87.15zm-58.47 112L.55 491.64a16.21 16.21 0 0 0 20 19.75l379-105.1c-4.27-174.89-123.08-292.14-299.15-294.1zM128 416a32 32 0 1 1 32-32 32 32 0 0 1-32 32zm48-152a32 32 0 1 1 32-32 32 32 0 0 1-32 32zm104 104a32 32 0 1 1 32-32 32 32 0 0 1-32 32z' })
])

const SoupIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 512 512', fill: '#ff6106' }, [
  h('path', { d: 'M400.42,239.025c3.623,4.43,6.856,9.011,9.61,13.742c-19.939,49.982-90.592,86.925-174.695,86.925c-84.111,0-154.757-36.943-174.696-86.925c26.428-45.438,94.664-77.809,174.696-77.809c34.922,0,67.6,6.167,95.539,16.9c11.826-24.242,29.331-57.668,48.918-87.074c-39.877-19.924-90.008-31.802-144.458-31.802C105.359,72.982,0,140.59,0,223.989c0,76.484,58.828,233.374,235.335,233.374c176.252,0,235.162-156.44,235.326-233.052c0-0.105,0.008-0.209,0.008-0.322c0-20.126-6.16-39.331-17.296-56.889C433.329,189.148,413.645,215.958,400.42,239.025z' }),
  h('path', { d: 'M439.07,70.542c-46.748,37.4-101.759,163.26-101.759,163.26c-2.417,7.23,11.668,15.291,22.004,15.867c7.844,0.434,10.464-2.62,10.464-2.62c19.61-43.148,77.719-119.924,120.283-141.202C542.363,79.696,491.372,28.703,439.07,70.542z' })
])

const DessertIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 512 512', fill: '#ff6106' }, [
  h('path', { d: 'M489.35,251.974c-11.007-12.868-25.844-24.682-44.126-35.111l1.092-5.022l-0.431-1.83l-0.176-0.046c0.315-3.238,0.561-6.538,0.738-9.945c0.484-10.098,0.484-20.489,0.484-30.965c0-15.229-6.107-30.235-17.66-43.395c-15.39-17.49-39.087-31.596-70.422-41.933c-30.55-9.976-66.107-15.26-102.849-15.268c-49.109,0.038-95.542,9.43-130.73,26.436c-17.998,8.73-32.304,19.082-42.564,30.812c-11.537,13.152-17.628,28.134-17.621,44.164c0,12.922,0,26.251,1.07,39.103l-0.5,0.077l1.207,7.784c-18.367,10.476-33.273,22.328-44.31,35.265C7.792,269.38-0.007,288.915,0,308.598c-0.007,19.02,7.353,37.91,21.19,54.793l-0.061,0.046l1.507,1.777l0.007,0.008c20.39,23.789,52.017,43.003,94.027,57.147c41.31,13.844,89.489,21.167,139.337,21.174c66.523-0.046,129.338-13.022,176.879-36.557c23.966-11.906,42.956-25.958,56.47-41.772c14.791-17.29,22.628-36.826,22.643-56.662C512.008,288.87,504.178,269.302,489.35,251.974z M206.938,126.181l50.301-27.127l47.825,25.789v18.975l-50.302,27.127l-47.824-25.781V126.181z M150.752,270.871c-17.252-7.122-31.796-16.159-42.034-26.135c-2.8-2.723-5.399-5.661-7.714-8.76l0.354-0.385l-2.731-2.992c-3.454-5.291-5.799-10.798-6.976-16.259c-0.754-4.669-1.3-10.291-1.623-16.714c14.075,18.736,40.864,34.419,76.391,44.602v51.956c0,10.752,8.752,19.505,19.506,19.505c10.76,0,19.505-8.753,19.505-19.505v-23.359c0-4.369,3.554-7.922,7.922-7.922c4.369,0,7.907,3.554,7.907,7.922c0,9.161,7.461,16.606,16.621,16.606c9.16,0,16.606-7.445,16.606-16.606v-16.736l1.522,0.015c75.114,0,140.506-22.474,165.957-56.454c-0.146,2.846-0.331,5.607-0.562,8.244c-0.231,2.461-0.507,4.792-0.8,6.838c-1.646,6.822-4.615,13.429-8.923,19.729l-0.999,1.23l0.1,0.1c-1.885,2.631-3.854,5.053-6.007,7.392c-12.937,13.967-32.919,25.566-57.793,33.565c-25.997,8.384-57.416,12.814-90.974,12.814h-1.722v17.46h1.722c47.486-0.016,89.674-8.261,122.008-23.836c16.152-7.806,29.466-17.275,39.549-28.142c1.407-1.508,2.746-3.069,4.023-4.646c0.346,1.63,0.569,3.838,0.684,6.661c0.184,4.054,0.184,9.538,0.184,16.998c-0.008,9.26-3.907,18.444-11.606,27.296c-11.999,13.799-33.173,26.151-59.624,34.773c-28.089,9.191-60.993,14.06-95.42,14.06c-44.787,0-88.481-8.737-119.886-23.974c-14.836-7.192-26.858-15.791-34.756-24.859c-7.7-8.852-11.607-18.036-11.622-27.296c-0.024-13.168,0.084-19.821,0.823-23.397c1.908,2.246,3.976,4.453,6.176,6.607c12.038,11.667,28.027,21.682,47.556,29.742l1.585,0.662l6.661-16.136L150.752,270.871z M470.744,349.339c-16.852,19.844-46.395,37.534-83.19,49.84c-38.849,13.022-84.344,19.906-131.677,19.906c-62.838,0-121.747-12.075-165.888-34.012c-20.728-10.276-37.58-22.628-48.725-35.734c-11.138-13.091-16.79-26.796-16.798-40.741c0.008-13.899,5.638-27.582,16.728-40.65c8.546-10.06,20.121-19.467,34.45-28.012c-0.654,1.369-1.2,2.768-1.63,4.192c-0.976,3.3-1.484,6.822-1.73,12.145c-0.2,4.614-0.2,10.253-0.2,17.782c-0.008,13.468,5.499,26.882,15.928,38.78c14.314,16.329,37.604,30.12,67.323,39.88c29.843,9.761,64.646,14.922,100.672,14.929c48.079-0.023,93.419-9.16,127.67-25.734c17.159-8.323,30.726-18.114,40.318-29.074c10.422-11.906,15.929-25.32,15.921-38.78l-0.008-3.13c-0.007-11.36-0.015-18.213-1.284-24.313c-0.484-2.353-1.253-4.592-2.261-6.661c14.299,8.523,25.836,17.89,34.365,27.905c11.145,13.106,16.798,26.812,16.806,40.742C487.526,322.542,481.874,336.248,470.744,349.339z' })
])

const SaladIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 511.999 511.999', fill: '#ff6106' }, [
  h('path', { d: 'M203.271,92.915c-0.493,0-0.985,0.01-1.477,0.016l-5.121,13.178l44.17,34.042c7.051,5.434,8.359,15.553,2.926,22.604c-3.174,4.12-7.95,6.281-12.777,6.281c-3.435,0-6.896-1.095-9.827-3.354l-27.767-21.4v29.012c0,8.901-7.216,16.117-16.117,16.117s-16.117-7.216-16.117-16.117v-29.013l-27.766,21.4c-2.932,2.26-6.392,3.354-9.827,3.354c-4.827,0-9.601-2.161-12.777-6.281c-5.432-7.051-4.125-17.169,2.926-22.604l50.168-38.664l3.015-7.762c-5.207-0.534-10.422-0.808-15.608-0.808c-44.894,0-80.666,11.223-106.325,33.358C15.13,152.017,0,191.558,0,243.79c0,71.125,42.108,132.589,102.697,160.805l136.181-232.307c14.711-25.094,36.334-43.59,61.373-53.109C275.694,101.899,243.149,92.915,203.271,92.915z' }),
  h('path', { d: 'M204.61,41.202c-8.294-3.222-17.636,0.887-20.859,9.184l-16.845,43.337l34.89-0.793l0.869-2.238l11.127-28.63C217.018,53.766,212.907,44.427,204.61,41.202z' }),
  h('path', { d: 'M511.878,187.62c-1.107-9.953-9.533-17.312-19.316-17.312c-0.717,0-1.441,0.04-2.171,0.122l-43.375,4.819l37.389-37.39c7.599-7.599,7.599-19.916,0-27.516c-3.799-3.799-8.779-5.7-13.757-5.7c-4.98,0-9.959,1.9-13.759,5.7l-37.39,37.39l4.821-43.374c1.187-10.679-6.509-20.3-17.19-21.486c-0.73-0.082-1.455-0.121-2.173-0.121c-9.783,0-18.209,7.36-19.314,17.31l-6.876,61.886c-12.27-7.242-25.753-11.089-39.284-11.089c-2.802,0-5.606,0.183-8.404,0.515c-0.202,0.026-0.406,0.032-0.608,0.058c-23.544,3.021-44.693,17.795-58.023,40.534l-29.023,49.51l42.511,42.511c7.597,7.597,7.597,19.918-0.001,27.516c-7.597,7.597-19.917,7.597-27.516,0c-0.001,0,0,0-0.001,0l-35.33-35.331l-82.676,141.034l-14.885,25.39c-4.479,7.638-3.235,17.336,3.026,23.596c3.749,3.75,8.732,5.701,13.765,5.701c3.373,0,6.767-0.877,9.832-2.672l235.427-138.006l-39.587-39.589l-24.758-24.76c-7.599-7.597-7.6-19.919-0.001-27.516c7.597-7.597,19.919-7.597,27.517,0l3.806,3.806l65.787,65.788c12.695-12.376,20.827-27.905,22.976-44.667c2.117-16.494-1.664-33.3-10.516-48.297l61.888-6.876C505.369,207.917,513.064,198.298,511.878,187.62z' })
])

const MainDishIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 512 512', fill: '#ff6106' }, [
  h('path', { d: 'M368,128h.09' }),
  h('path', { d: 'M479.55,96H388.49l8.92-35.66,38.32-13.05c8.15-2.77,13-11.43,10.65-19.71a16,16,0,0,0-20.54-10.73l-47,16a16,16,0,0,0-10.36,11.27L355.51,96H224.45c-8.61,0-16,6.62-16.43,15.23A16,16,0,0,0,224,128h2.75l1,8.66A8.3,8.3,0,0,0,236,144h0c39,0,73.66,10.9,100.12,31.52A121.9,121.9,0,0,1,371,218.07a123.4,123.4,0,0,1,10.12,29.51,7.83,7.83,0,0,0,3.29,4.88,72,72,0,0,1,26.38,86.43,7.92,7.92,0,0,0-.15,5.53A96,96,0,0,1,416,376c0,22.34-7.6,43.63-21.4,59.95a80.12,80.12,0,0,1-28.78,21.67,8,8,0,0,0-4.21,4.37,108.19,108.19,0,0,1-17.37,29.86l0,0a2.5,2.5,0,0,0,1.9,4.11h49.21a48.22,48.22,0,0,0,47.85-44.14L477.4,128H480a16,16,0,0,0,16-16.77C495.58,102.62,488.16,96,479.55,96Z' }),
  h('path', { d: 'M108.69,320a23.87,23.87,0,0,1,17,7l15.51,15.51a4,4,0,0,0,5.66,0L162.34,327a23.87,23.87,0,0,1,17-7H375.92a8,8,0,0,0,8.08-7.92V312a40.07,40.07,0,0,0-32-39.2c-.82-29.69-13-54.54-35.51-72C295.67,184.56,267.85,176,236,176H164c-68.22,0-114.43,38.77-116,96.8A40.07,40.07,0,0,0,16,312h0a8,8,0,0,0,8,8Z' }),
  h('path', { d: 'M185.94,352a8,8,0,0,0-5.66,2.34l-22.14,22.15a20,20,0,0,1-28.28,0l-22.14-22.15a8,8,0,0,0-5.66-2.34H32.66A15.93,15.93,0,0,0,16.9,365.17,65.22,65.22,0,0,0,16,376c0,30.59,21.13,55.51,47.26,56,2.43,15.12,8.31,28.78,17.16,39.47C93.51,487.28,112.54,496,134,496H266c21.46,0,40.49-8.72,53.58-24.55,8.85-10.69,14.73-24.35,17.16-39.47,26.13-.47,47.26-25.39,47.26-56a65.22,65.22,0,0,0-.9-10.83A15.93,15.93,0,0,0,367.34,352Z' })
])

const SideIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 512 512', fill: '#ff6106' }, [
  h('path', { d: 'M321.31,446.475H190.69c-10.182,0-18.437,8.255-18.437,18.437s8.255,18.437,18.437,18.437H321.31c10.182,0,18.437-8.255,18.437-18.437S331.492,446.475,321.31,446.475z' }),
  h('path', { d: 'M493.563,217.122h-14.034c-5.19-20.848-18.968-38.718-37.664-49.075c19.955-65.677-49.662-122.425-109.873-90.473c-29.548-65.262-122.464-65.197-151.981,0C119.85,45.648,50.156,102.29,70.134,168.048c-18.697,10.358-32.473,28.226-37.664,49.075H18.437C8.255,217.122,0,225.377,0,235.559c0,10.182,8.255,18.437,18.437,18.437H29.93v27.853c0,77.802,63.298,141.099,141.099,141.099H340.97c77.804,0,141.1-63.297,141.1-141.099v-27.853h11.493c10.182,0,18.437-8.255,18.437-18.437C512,225.377,503.745,217.122,493.563,217.122z M71.593,217.122c5.42-10.44,15.304-18.358,27.338-20.896c12.752-2.69,18.775-17.447,11.519-28.292c-4.422-6.61-6.759-14.325-6.759-22.313c0-38.689,49.593-54.935,72.564-23.861c10.44,14.124,32.95,6.933,33.258-10.634c0.444-25.186,21.298-45.676,46.487-45.676c25.188,0,46.044,20.49,46.487,45.676c0.312,17.564,22.818,24.759,33.261,10.633c22.972-31.078,72.561-14.829,72.561,23.862c0,7.988-2.336,15.703-6.759,22.312c-7.248,10.833-1.249,25.599,11.518,28.293c12.034,2.538,21.917,10.455,27.338,20.896H71.593z' }),
  h('path', { d: 'M330.942,148.378c-15.114,0-29.068,8.827-35.547,22.486c-4.363,9.2-0.442,20.195,8.757,24.559c2.55,1.211,5.24,1.783,7.887,1.783c6.9,0,13.518-3.891,16.67-10.54c0.892-1.89,3.572-1.888,4.463,0c4.365,9.199,15.358,13.121,24.559,8.756c9.199-4.365,13.121-15.36,8.756-24.559C360.009,157.204,346.056,148.378,330.942,148.378z' })
])

const MeatIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 512 512', fill: '#ff6106' }, [
  h('path', { d: 'M511.904,253.069c-1.554-48.548-44.377-84.942-104.409-88.656c-120.865-7.486-109.51-67.345-209.664-73.722c-5.642-0.361-11.206-0.536-16.662-0.536c-102.294,0-171.103,61.839-180.098,137.418c-0.548,4.591-0.839,9.124-0.968,13.612H0v52.824h0.31c3.218,66.926,53.423,119.234,135.051,121.51c48.123,1.342,182.039,5.082,224.552,6.268c69.628,1.94,136.722-44.738,149.856-104.255c0.87-3.94,1.419-7.815,1.767-11.639H512v-52.824H511.904z M483.976,270.015c-10.169,46.098-63.947,83.595-119.866,83.595c-1.154,0-2.308-0.02-3.462-0.046l-56.247-1.574l-168.305-4.694c-36.877-1.032-66.784-13.638-86.496-36.458c-18.042-20.898-25.967-49.361-22.304-80.144c7.996-67.196,71.272-114.127,153.874-114.127c4.913,0,9.956,0.162,14.985,0.484c40.514,2.579,58.118,14.489,80.41,29.578c27.553,18.642,58.788,39.779,129.299,44.144c29.797,1.844,54.784,13.387,68.557,31.655C484.569,235.897,487.877,252.353,483.976,270.015z' }),
  h('path', { d: 'M338.827,236.587l-101.03-7.222c-10.969-0.786-20.957-6.596-27.05-15.746l-27.257-40.882c-3.037-4.553-9.182-5.784-13.734-2.747c-4.553,3.037-5.784,9.182-2.747,13.734l12.522,18.784c5.474,8.215,7.287,18.338,5.004,27.946c-2.283,9.608-8.454,17.829-17.043,22.704l-38.947,22.104c-4.759,2.702-6.43,8.744-3.728,13.502c2.702,4.759,8.744,6.43,13.502,3.728l69.48-39.431c6.1-3.469,13.09-5.043,20.086-4.546l109.535,7.828c5.455,0.387,10.188-3.72,10.582-9.176C348.39,241.714,344.289,236.974,338.827,236.587z' })
])

const SauceIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 256 256', fill: '#ff6106' }, [
  h('path', { d: 'M171.2,70.6c-2.2-1.5-4.8-2.4-7.5-2.4h0.8v-18h-19.2v-0.1l-6.8-34C137.8,12,134.2,9,130,9h-4.8c-4.1,0.1-7.6,3.1-8.4,7.1l-6.9,34v0.1H90.7v18h0.4c-3.4,0.2-6.5,1.6-8.8,3.9c-2.6,2.6-4.1,6-4.1,9.7v151.6c0,4.5,2.2,8.7,5.8,11.2c2.3,1.6,5,2.5,7.7,2.5h71.8c3.7,0,7.1-1.4,9.6-4c2.6-2.6,4-6,4-9.6V81.8C177,77.4,174.8,73.2,171.2,70.6z M101.9,235.5h-12V80.1h12V235.5z' })
])

const PastaIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 512 512', fill: '#ff6106' }, [
  h('path', { d: 'M432.315,177.542v152.435c0.058,22.202-6.934,48.656-21.59,68.446c-7.32,9.932-16.448,18.274-27.644,24.203c-11.214,5.913-24.572,9.505-40.936,9.514c-5.444,0.008-11.23-0.402-17.36-1.274c-15.543-2.211-25.249-7.151-30.726-12.226c-5.452-5.15-7.319-10.268-7.404-15.878c-0.025-6.448,3.074-13.844,9.354-19.898c6.264-6.047,15.468-10.628,27.168-11.465c3.994-0.285,7.73-0.427,11.231-0.427c29.394,0.067,42.384,8.927,47.366,13.835c5.017,5.024,13.157,5.033,18.19,0.016c5.024-5.025,5.024-13.165,0-18.19c-10.335-10.426-30.911-21.439-65.556-21.388c-4.154,0.008-8.5,0.167-13.065,0.485c-17.512,1.239-32.544,8.308-43.213,18.626c-10.644,10.301-17.168,23.952-17.202,38.406c-0.084,12.454,5.251,25.266,15.686,34.788c10.419,9.581,25.308,16.03,44.544,18.794c7.261,1.022,14.254,1.524,20.987,1.532c20.2,0.008,37.996-4.581,52.962-12.512c22.494-11.892,38.288-30.936,48.322-51.63c10.049-20.753,14.588-43.28,14.614-63.756V177.542c0-7.102-5.762-12.864-12.864-12.864C438.076,164.678,432.315,170.44,432.315,177.542z' }),
  h('path', { d: 'M294.543,232.856c6.876,1.775,13.893-2.37,15.66-9.245l44.544-172.903c1.776-6.876-2.362-13.893-9.245-15.669c-6.875-1.775-13.894,2.37-15.661,9.245l-44.544,172.904C283.523,224.072,287.659,231.09,294.543,232.856z' }),
  h('path', { d: 'M339.934,242.99c6.876,1.776,13.893-2.37,15.66-9.246l40.926-158.841c1.776-6.884-2.362-13.894-9.245-15.661c-6.875-1.775-13.894,2.362-15.661,9.246l-40.926,158.833C328.913,234.205,333.05,241.223,339.934,242.99z' }),
  h('path', { d: 'M387.016,257.369c6.876,1.775,13.894-2.362,15.661-9.246l38.984-151.288c1.775-6.876-2.362-13.894-9.246-15.67c-6.876-1.775-13.893,2.37-15.66,9.246l-38.984,151.296C375.995,248.584,380.132,255.594,387.016,257.369z' }),
  h('path', { d: 'M238.065,187.676c9.765,3.668,22.562,7.478,36.028,11.112l9.045-35.081l-22.838-8.994c-8.576-3.383-10.937-9.405-8.274-16.163c2.428-6.172,7.261-11.28,16.079-8.182l21.448,8.45l7.679-29.823l-17.93-7.059c-7.856-2.906-8.618-10.778-6.189-16.951c2.664-6.75,8.5-9.546,17.067-6.18l13.459,5.302l9.514-36.916c-6.013-2.94-11.717-5.586-16.75-7.662c-34.294-14.128-69.811-3.275-88.519,6.214c-10.502,5.326-21.28,11.398-33.206,6.699L47.844,0v54.058l109.983,41.179c11.926,4.698,15.67,16.48,19.714,27.535C184.761,142.477,203.344,174.636,238.065,187.676z' }),
  h('path', { d: 'M456.258,420.75c-4.271-5.075-11.85-5.728-16.917-1.458c-5.075,4.272-5.729,11.842-1.457,16.917c1.641,2.026,2.211,3.685,2.26,6.114c0.026,2.914-1.264,7.261-5.024,12.294c-5.56,7.537-16.489,16.096-32.61,22.511c-16.113,6.448-37.342,10.853-63.329,10.853c-42.258-0.008-69.937-8.911-87.958-20.367c-17.998-11.482-26.866-25.61-31.162-38.021c-2.152-6.264-8.986-9.614-15.258-7.453c-6.264,2.152-9.606,8.977-7.454,15.258c5.762,16.934,18.232,36.061,41.003,50.482C261.095,502.335,293.622,512,339.18,512c38.264-0.017,68.546-8.576,89.944-21.213c10.686-6.34,19.186-13.692,25.258-21.825c6.029-8.098,9.748-17.159,9.774-26.639C464.205,434.602,461.425,426.813,456.258,420.75z' })
])

const DrinkIcon = () => h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: '80', height: '80', viewBox: '0 0 32 32', fill: '#ff6106' }, [
  h('path', { d: 'M25 8.918h-18.045l0.018-1.942h1.441l3.052-3.007h9.148l2.989 3.007h1.441l-0.044 1.942zM17.544 5.974h-3.008v1.002h3.008v-1.002zM23.656 13.994h-15.246l-0.39-4.010h16.040l-0.404 4.010zM23.245 22.953h-14.474l-0.751-7.957h16.040l-0.815 7.957zM22.243 28.029c0 0.553-0.449 1.002-1.003 1.002h-10.463c-0.554 0-1.003-0.449-1.003-1.002l-0.396-4.073h13.274l-0.409 4.073z' })
])

function getCategoryIcon(categoryId?: number) {
  switch (categoryId) {
    case 1: return PizzaIcon // Pizzák
    case 3: return MainDishIcon // Gyors ételek
    case 4: return SaladIcon // Saláták
    case 5: return SoupIcon // Bögrés levesek
    case 6: return MeatIcon // Sültek
    case 7: return SideIcon // Köretek
    case 8: return SauceIcon // Öntetek
    case 9: return DessertIcon // Palacsinták
    case 10: return PastaIcon // Tészták
    case 11: return SaladIcon // Vegetáriánus ételek
    case 12: return DrinkIcon // Italok
    default: return MainDishIcon // Default fallback
  }
}

// For pizza category, prefer 32cm as default, otherwise use first price
function getDefaultPrice(it: Item): Price | undefined {
  if (!Array.isArray(it.prices) || it.prices.length === 0) return undefined
  if (it.category_id === 1) {
    // Try to find 32cm size first for pizza category
    const size32 = it.prices.find((p) => p.label.includes('32'))
    if (size32) return size32
  }
  return it.prices[0]
}

function ensureSelections(list: Item[]) {
  const seenIds = new Set<number>()
  list.forEach((item) => {
    seenIds.add(item.id)
    if (Array.isArray(item.prices) && item.prices.length) {
      const current = selectedPrices[item.id]
      const stillValid = current && item.prices.some((p) => p.label === current.label)
      if (!stillValid) {
        const defaultPrice = getDefaultPrice(item)
        if (defaultPrice) {
          selectedPrices[item.id] = defaultPrice
        }
      }
    } else if (selectedPrices[item.id]) {
      delete selectedPrices[item.id]
    }
  })

  Object.keys(selectedPrices).forEach((idKey) => {
    const numericId = Number(idKey)
    if (!seenIds.has(numericId)) {
      delete selectedPrices[numericId]
    }
  })
}

function selectPrice(itemId: number, price: Price){ selectedPrices[itemId] = price }

function formatPrice(n:number){ return n.toLocaleString('hu-HU') }

function openExtrasModal(item: Item) {
  emit('openExtras', { item })
}

function addToCart(item: Item){
  const price = selectedPrices[item.id] ?? getDefaultPrice(item)
  if (!price) return
  emit('add', { item, price })
}

ensureSelections(props.items)

watch(
  () => props.items,
  (newItems) => {
    ensureSelections(newItems)
  },
  { deep: true }
)
</script>

<style scoped>
.cards {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.card {
  display: grid;
  grid-template-columns: 3fr 1fr;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  overflow: hidden;
}

.card-content {
  padding: 24px;
  display: flex;
  flex-direction: column;
  flex: 1;
}

.card:has(.card-right) .card-content {
  flex: 1;
}

.card:not(:has(.card-right)) .card-content {
  padding: 24px;
  width: 100%;
}

.card-left {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  flex: 1;
}

.name {
  margin: 0 0 8px;
  font-size: 20px;
  font-weight: 600;
  color: #1a1a1a;
}

.desc {
  margin: 0 0 16px;
  color: #888;
  font-size: 14px;
  line-height: 1.5;
}

.prices {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}

.prices button {
  background: #fff;
  border: 1px solid #d0d0d0;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
  color: #666;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.prices button:hover {
  border-color: #ff6106;
  color: #ff6106;
}

.prices button.selected {
  background: #fff4e6;
  border-color: #ff6106;
  color: #ff6106;
  font-weight: 600;
}

.prices-empty {
  color: #aaa;
  font-size: 13px;
  font-style: italic;
  margin-bottom: 12px;
}

.price-display {
  margin-bottom: 0;
}

.price-amount {
  font-size: 18px;
  font-weight: 600;
  color: #1a1a1a;
}

.bottom-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
}

.actions {
  display: flex;
  gap: 8px;
}

.btn-outline {
  width: auto;
  background: #fff;
  border: 2px solid #ff6106;
  color: #ff6106;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-outline:hover {
  background: #fff4e6;
}

.btn-outline svg {
  width: 20px;
  height: 20px;
}

.btn-primary {
  width: auto;
  background: #ff6106;
  color: #fff;
  border: 2px solid #ff6106;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-primary:hover:not(:disabled) {
  background: #e55a00;
  border-color: #e55a00;
}

.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary svg {
  width: 20px;
  height: 20px;
}

.card-right {
  width: 100%;
  min-width: 0;
  overflow: hidden;
  position: relative;
  flex-shrink: 0;
  min-height: 200px;
}

.card-right img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.icon-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #fff4e6 0%, #ffe8cc 100%);
}

/* Responsive Design */
@media (max-width: 768px) {
  .card {
    grid-template-columns: 2fr 1fr;
    grid-template-rows: 1fr;
    gap: 0;
    overflow: hidden;
    min-height: 200px;
  }

  .card-content {
    padding: 16px;
  }

  .bottom-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .actions {
    width: 100%;
  }

  .btn-outline,
  .btn-primary {
    flex: 1;
    width: 100%;
  }

  .card-right {
    width: 100%;
    height: 100%;
    min-width: 0;
    min-height: 0;
    position: relative;
  }

  .card-right img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .icon-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .name {
    font-size: 18px;
  }

  .desc {
    font-size: 13px;
  }

  .prices button {
    font-size: 12px;
    padding: 6px 12px;
  }

  .price-amount {
    font-size: 16px;
  }

  .btn-outline,
  .btn-primary {
    font-size: 13px;
    padding: 9px 14px;
  }
}

@media (max-width: 480px) {
  .card {
    padding: 0;
    gap: 0;
    min-height: 180px;
  }

  .card-content {
    padding: 12px;
  }

  .card-right {
    width: 100%;
    height: 100%;
    min-height: 0;
  }

  .card-right img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .name {
    font-size: 16px;
  }

  .desc {
    font-size: 12px;
    margin-bottom: 12px;
  }

  .prices {
    gap: 8px;
    margin-bottom: 10px;
  }

  .prices button {
    font-size: 11px;
    padding: 5px 10px;
  }

  .price-display {
    margin-bottom: 12px;
  }

  .price-amount {
    font-size: 14px;
  }

  .actions {
    gap: 8px;
  }

  .btn-outline,
  .btn-primary {
    font-size: 12px;
    padding: 8px 12px;
  }
}
</style>
